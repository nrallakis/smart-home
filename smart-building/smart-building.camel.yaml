- route:
    id: Topic router
    nodePrefixId: route-182
    from:
      id: from-eb99
      uri: kafka
      parameters:
        topic: home_assistant_states
        brokers: 192.168.1.11:9092
      steps:
        - to:
            id: to-a0c7
            uri: kamelet:log-sink
        - choice:
            id: choice-device-class
            when:
              - id: when-09a7
                expression:
                  simple:
                    id: simple-f62d
                    expression: ${jsonpath('$.attributes.device_class')} != null
                steps:
                  - setHeader:
                      id: setHeader-cf4e
                      name: KafkaTopic
                      expression:
                        simple:
                          id: simple-b84b
                          expression: ${jsonpath('$.attributes.device_class')}
            otherwise:
              id: otherwise-806a
              steps:
                - setHeader:
                    id: setHeader-8e69
                    name: KafkaTopic
                    expression:
                      constant:
                        id: constant-8454
                        expression: other
        - setBody:
            id: setBody-cdb0
            expression:
              simple:
                id: simple-d030
                expression: |
                  {
                      "id": "${jsonpath('$.entity_id')}",
                      "type": "DeviceMeasurement",
                      "name": "${jsonpath('$.attributes.friendly_name')}",
                      "measurementType": "${jsonpath('$.attributes.device_class', true)}",
                      "numValue": ${jsonpath('$.state')},
                      "unit": "${jsonpath('$.attributes.unit_of_measurement')}",
                      "dateObserved": "${jsonpath('$.last_updated')}"
                  }
        - toD:
            id: toD-12bf
            uri: >-
              kamelet:kafka-not-secured-sink?bootstrapServers=192.168.1.11:9092&topic=${header.KafkaTopic}
- route:
    id: Temperature consumer
    nodePrefixId: route-10c
    from:
      id: from-b299
      uri: kafka
      parameters:
        topic: temperature
        brokers: 192.168.1.11:9092
      steps:
        - to:
            id: to-b925
            uri: kamelet:log-sink
- route:
    id: Humidity consumer
    nodePrefixId: route-11c
    from:
      id: from-b209
      uri: kafka
      parameters:
        topic: humidity
        brokers: 192.168.1.11:9092
      steps:
        - to:
            id: to-b955
            uri: kamelet:log-sink
- route:
    id: Connectivity consumer
    nodePrefixId: route-844
    from:
      id: from-eea6
      uri: kafka
      parameters:
        topic: data_rate
        brokers: 192.168.1.11:9092
      steps:
        - to:
            id: to-a845
            uri: kamelet:log-sink
- route:
    id: Other consumer
    nodePrefixId: route-b7a
    from:
      id: from-4fab
      uri: kafka
      parameters:
        topic: other
        brokers: 192.168.1.11:9092
      steps:
        - to:
            id: to-df9b
            uri: kamelet:log-sink
